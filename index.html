<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>PlaceMap</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>

	<!-- Room code mechanism -->  
	<div id="logininterface">
		<p id="introtext">Share this code with your friends:</p>
		<br/>
		<p id="room_code"></p>

		<input type="text" id="name" value="enter your name here">
		<input type="text" id="codeinput" value="enter your friend's code here">
		<input type="submit" id="codesubmit" value="submit">

	</div>
	  
	<br/>
	<p>PLAYERS IN THE ROOM</p> 
	<p id="p1">You</p> 
	<p id="p2">-</p>
	<p id="p3">-</p>
	<p id="p4">-</p>
	<p id="p5">-</p>
	<p id="p6">-</p> 
	  
	<br/>
	<p>MESSAGE: <span id="message"></span></p>   

    <!-- Client Code    -->
    <script type="text/javascript">

		var players = ["Me","-","-","-","-","-"];
		
		var nPlayers = 1;
		
		var ownPosition = 0;
		
		var name = "Host";
		
		//Define random room code
		
		function makeid(length) {
		   var result           = '';
		   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
		   var charactersLength = characters.length;
		   for ( var i = 0; i < length; i++ ) {
			  result += characters.charAt(Math.floor(Math.random() * charactersLength));
		   }
		   return result;
		}		
		var randomCode = makeid(5);
		$('#room_code').text(randomCode);	
			
      // Get WebSocket
      var socket = io();

		
		
      // Get DOM elements
      var input = document.getElementById("input");
      var output = document.getElementById("output");
		
      // Join a channel
      var room = randomCode;
      socket.emit("join", room);		
	
	  // Code for joining session with someone else's code
		
		$('#codesubmit').on('click', function() {
			var c = $('#codeinput').val();
			name = $('#name').val();
			
			socket.emit("join", c);
			
			socket.emit("addplayer", name);
			$('#message').append("<br/>"+name+", you are now in room "+c);
			
			$('#logininterface').hide();
		});
	
      socket.on("writemessage", function (msg) {
		  $('#message').append("<br/>"+msg);
      });
		
	  socket.on("defineposition", function (msg) {
		  ownPosition = msg-1;
		  $('#message').append("my own position is "+ownPosition);
		  nPlayers = ownPosition+1;
		 
		  /*if(ownPosition!=0) players[0] = "Host";
		  $('#p1').text(players[0]);
		  $('#p2').text(players[1]);
		  $('#p3').text(players[2]);
		  $('#p4').text(players[3]);
		  $('#p5').text(players[4]);
		  $('#p6').text(players[5]);*/
      });	
		
	  socket.on("defineclients", function (msg) {
	  	
		$('#message').append(msg);
		  var c = msg.split("/");
		for(var i=0; i<c.length; i++){
			players[i] = c[i];
		} 
		  
		$('#p1').text(players[0]);
		  $('#p2').text(players[1]);
		  $('#p3').text(players[2]);
		  $('#p4').text(players[3]);
		  $('#p5').text(players[4]);
		  $('#p6').text(players[5]);  
	  });
		
	  socket.on("addplayer", function (msg) {
		  players[nPlayers] = msg;
		  nPlayers++;
		  $('#p1').text(players[0]);
		  $('#p2').text(players[1]);
		  $('#p3').text(players[2]);
		  $('#p4').text(players[3]);
		  $('#p5').text(players[4]);
		  $('#p6').text(players[5]);
      });
		
	$(window).blur(function(){
		socket.emit("gounactive", name);
	});
	$(window).focus(function(){
		socket.emit("goactive", name);
	});	
		
    </script>
  </body>
</html>