<html>
  <head>
    <meta charset="utf-8">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name='viewport', 
     content='width=device-width, initial-scale=1.0, maximum-scale=1.0, 
     user-scalable=0' >
	<meta http-equiv="ScreenOrientation" content="autorotate:disabled">
	  
    <title>PlaceMap_v1.05</title>
	  
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
	<script src="/javascript2.js"></script> 
	  
	  
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="reset.css">
	<script type="text/javascript" src="jquery.js"></script>
	<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<script type="text/javascript" src="javascript.js"></script>
	
	<link rel="shortcut icon" href="img/icon.png" />
	<link rel="apple-touch-icon" href="img/icon.png" />
	<link rel="apple-touch-icon" sizes="72x72" href="img/icon.png" />
	<link rel="apple-touch-icon" sizes="114x114" href="img/icon.png" />
	<link rel="apple-touch-icon" sizes="144x144" href="img/icon.png" /> 
	  
  </head>
  <body>
	<!-- Room code mechanism -->  
	<div id="logininfo">
		<p id="introtext">Share this code with your friends:</p>
		<p id="room_code"></p>
	</div>
	<div id="logininterface">  
		<input type="text" id="codeinput" value="enter your friend's code here">
		<input type="submit" id="codesubmit" value="submit">
	</div>
	  
	<br/>
	  <p>PLAYERS IN THE ROOM: <span id="playersInTheRoom">1</span></p>
	  <p>ACTIVE PLAYERS IN THE ROOM: <span id="activePlayers">1</span></p>
	<br/>
	<p>MESSAGES: <span id="message"></span></p>   

    <!-- Client Code    -->
    <script type="text/javascript">
		
		var nPlayers = 1;
		var activePlayers = 1;
		
		//Define random room code
		
		function makeid(length) {
		   var result           = '';
		   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
		   var charactersLength = characters.length;
		   for ( var i = 0; i < length; i++ ) {
			  result += characters.charAt(Math.floor(Math.random() * charactersLength));
		   }
		   return result;
		}		
		var randomCode = makeid(5);
		$('#room_code').text(randomCode);	
			
      // Get WebSocket
      var socket = io();
		
      // Get DOM elements
      var input = document.getElementById("input");
      var output = document.getElementById("output");
		
      // Join a channel
      var room = randomCode;
      socket.emit("join", room);		
	
	  // Code for joining session with someone else's code
		
		$('#codesubmit').on('click', function() {
			var c = $('#codeinput').val();
			
			socket.emit("join", c);
			
			$('#logininterface').hide();
			$('#room_code').text(c);
			$('#introtext').text("Share the room code with your friends:");
		});
	
      socket.on("writemessage", function (msg) {
		  $('#message').append("<br/>"+msg);
      });
		
	  socket.on("updateplayers", function (msg) {
		  nPlayers = msg;
		  if(activePlayers==1) activePlayers = msg;
		  $('#playersInTheRoom').text(nPlayers);
		  $('#activePlayers').text(activePlayers);
      });
		
	  socket.on("updateactiveplayers", function (msg) {
		  activePlayers = msg;
		  $('#activePlayers').text(activePlayers);
      });
		
	  socket.on("hidelogin", function (msg) {
		  $('#logininterface').hide();
		  $('#room_code').text(c);
		  $('#introtext').text("Share the room code with your friends:");
      });	
		
	$(window).blur(function(){
		socket.emit("gounactive", activePlayers);
	});
	$(window).focus(function(){
		socket.emit("goactive", activePlayers);
	});	
		
    </script>
  </body>
</html>