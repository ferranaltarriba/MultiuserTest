<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>PlaceMap</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>

	<!-- Room code mechanism -->  
	<p>Share this code with your friends:</p>
	<br/>
	<p id="room_code"></p>
	  
	<input type="text" id="codeinput" value="enter your friend's code here">
	<input type="submit" id="codesubmit" value="submit">
	  <br/>
    <!-- File input a nd image output -->
    <input type="file" id="input">
    <img src="" id="output">

    <!-- Client Code    -->
    <script type="text/javascript">

		//Define random room code
		
		function makeid(length) {
		   var result           = '';
		   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
		   var charactersLength = characters.length;
		   for ( var i = 0; i < length; i++ ) {
			  result += characters.charAt(Math.floor(Math.random() * charactersLength));
		   }
		   return result;
		}		
		var randomCode = makeid(5);
		$('#room_code').text(randomCode);	
			
      // Get WebSocket
      var socket = io();

		
		
      // Get DOM elements
      var input = document.getElementById("input");
      var output = document.getElementById("output");
		
      // Join a channel
      var room = randomCode;
      socket.emit("join", room);

      // Listen to file input events
      document.getElementById("input").addEventListener("change", function (event) {

        // Prepeare file reader
        var file = event.target.files[0];
        var fileReader = new FileReader();

        fileReader.onloadend = function (event) {
          // Send an image event to the socket
          var image = event.target.result
          output.src = image;
          socket.emit("image", image);
        };

        // Read file
        fileReader.readAsDataURL(file);
      })

      socket.on("image", function (image) {
        output.src = image;
      });
		
	
	  // Code for joining session with someone else's code
		
		$('#codesubmit').on('click', function() {
			var c = $('#codeinput').val();
			socket.emit("join", c);
			socket.emit("message", "friendhere");
			alert("You are now in room "+c);
		});
		
		/*
      document.getElementById("codeinput").addEventListener("change", function (event) {
		  var c = document.getElementById("codeinput").value;
		  alert("code is :");
		  alert(c);
           socket.emit("join", c);
          socket.emit("joinedroom", "joinedroom");
      });*/

      socket.on("message", function (msg) {
        alert(msg);
      });
		
    </script>
  </body>
</html>